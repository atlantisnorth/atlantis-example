version: 3
automerge: true

projects:
  - name: mon
    dir: mon
    apply_requirements: [mergeable, approved]

  - name: hm
    dir: hm
    apply_requirements: [mergeable, approved]
    workflow: terragrunt

workflows:
  terragrunt:
    plan:
      steps:
        - env:
            name: TERRAGRUNT_TFPATH
            command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
        - run: terragrunt plan -no-color -out $PLANFILE
    apply:
      steps:
        - env:
            name: TERRAGRUNT_TFPATH
            command: 'echo "terraform${ATLANTIS_TERRAFORM_VERSION}"'
        - run: terragrunt apply -no-color $PLANFILE
